import "user"
import "preset"

model Model {
    id           String        @id @default(cuid())
    connection   Connection    @json
    settings     Settings      @json
    name         String
    apiKey       String?       @encrypted

    User         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId       String        @default(auth().id)

    PresetModels PresetModel[]

    // Require login
    @@deny('all', auth() == null)

    // User can do everything
    @@allow('all', auth() == User)

    // Admins can delete models
    @@allow('delete', auth().role == admin)
}

enum Provider {
    local
    openai
}

type Connection {
    identifier String
    url        String @url("Connection url must me a valid URL")
}

type Settings {
    temperature Float

    @@validate(temperature < 0 || temperature > 10, "Temperature must be in range of 0 to 10")
}